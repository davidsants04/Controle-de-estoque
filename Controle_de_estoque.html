<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Controle de Estoque Profissional</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      background-color: #f8f9fa;
    }
    .container {
      max-width: 1200px;
      margin-top: 40px;
      padding: 30px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .table th {
      background-color: #0d6efd;
      color: white;
    }
    .btn-group {
      display: flex;
      gap: 10px;
    }
    .section-title {
      margin-top: 40px;
      border-bottom: 2px solid #0d6efd;
      padding-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="text-center mb-4">Painel de Controle de Estoque</h1>

    <!-- Cadastro de Produtos -->
    <div class="section-title"><h4>Cadastro de Produtos</h4></div>
    <div class="row mb-4">
      <div class="col-md-4">
        <input type="text" id="nome" class="form-control" placeholder="Nome do Produto" />
      </div>
      <div class="col-md-2">
        <input type="number" id="quantidade" class="form-control" placeholder="Quantidade" min="1" />
      </div>
      <div class="col-md-2">
        <input type="number" id="valorCompra" class="form-control" placeholder="Valor de Compra (R$)" step="0.01" min="0" />
      </div>
      <div class="col-md-2">
        <input type="number" id="valorVenda" class="form-control" placeholder="Valor de Venda (R$)" step="0.01" min="0" />
      </div>
      <div class="col-md-2">
        <div class="btn-group">
          <button id="btnAdicionarProduto" class="btn btn-success">Adicionar</button>
          <button id="btnExportarCSV" class="btn btn-primary">Exportar CSV</button>
          <button id="btnLimparEstoque" class="btn btn-secondary">Limpar Estoque</button>
        </div>
      </div>
    </div>

    <!-- Tabela de Estoque -->
    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th>Produto</th>
          <th>Quantidade</th>
          <th>Valor de Compra (R$)</th>
          <th>Valor de Venda (R$)</th>
          <th>Valor Total em Venda (R$)</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody id="tabela-estoque"></tbody>
    </table>

    <!-- Resumo Financeiro -->
    <div class="section-title"><h4>Resumo Financeiro</h4></div>
    <p><strong>Total em Estoque (Valor Venda):</strong> R$ <span id="total-estoque">0.00</span></p>
    <p><strong>Gastos (Valor Compra):</strong> R$ <span id="gastos">0.00</span></p>
    <p><strong>Lucros Estimados:</strong> R$ <span id="lucros">0.00</span></p>
    <p><strong>Consumo Interno:</strong> R$ <span id="consumo">0.00</span></p>

    <!-- Cadastro de Funcionários -->
    <div class="section-title"><h4>Cadastro de Funcionários</h4></div>
    <div class="row mb-3">
      <div class="col-md-4">
        <input type="text" id="funcionario-nome" class="form-control" placeholder="Nome do Funcionário" />
      </div>
      <div class="col-md-3">
        <input type="text" id="funcionario-cargo" class="form-control" placeholder="Cargo" />
      </div>
      <div class="col-md-3">
        <input type="number" id="funcionario-salario" class="form-control" placeholder="Salário (R$)" step="0.01" min="0" />
      </div>
      <div class="col-md-2">
        <button id="btnAdicionarFuncionario" class="btn btn-outline-success w-100">Cadastrar</button>
      </div>
    </div>
    <ul id="lista-funcionarios" class="list-group"></ul>
  </div>

  <script>
    let estoque = JSON.parse(localStorage.getItem("estoque")) || [];
    let funcionarios = JSON.parse(localStorage.getItem("funcionarios")) || [];

    // --- Funções Estoque ---

    function salvarEstoque() {
      localStorage.setItem("estoque", JSON.stringify(estoque));
    }

    function adicionarProduto() {
      const nome = document.getElementById('nome').value.trim();
      const quantidade = parseInt(document.getElementById('quantidade').value);
      const valorCompra = parseFloat(document.getElementById('valorCompra').value);
      const valorVenda = parseFloat(document.getElementById('valorVenda').value);

      if (!nome || isNaN(quantidade) || quantidade <= 0 ||
          isNaN(valorCompra) || valorCompra < 0 ||
          isNaN(valorVenda) || valorVenda <= 0) {
        alert("Preencha todos os campos corretamente.");
        return;
      }

      // Checa se produto já existe
      const produtoExistente = estoque.find(p => p.nome.toLowerCase() === nome.toLowerCase());

      if (produtoExistente) {
        // Atualiza quantidade e valores
        produtoExistente.quantidade += quantidade;
        produtoExistente.valorCompra = valorCompra;
        produtoExistente.valorVenda = valorVenda;
      } else {
        estoque.push({ nome, quantidade, valorCompra, valorVenda });
      }

      salvarEstoque();
      atualizarTabela();

      // Limpar campos
      document.getElementById('nome').value = "";
      document.getElementById('quantidade').value = "";
      document.getElementById('valorCompra').value = "";
      document.getElementById('valorVenda').value = "";
    }

    function removerProduto(nome) {
      if(confirm(`Deseja remover o produto ${nome}?`)) {
        estoque = estoque.filter(p => p.nome !== nome);
        salvarEstoque();
        atualizarTabela();
      }
    }

    function limparEstoque() {
      if(confirm("Tem certeza que deseja limpar todo o estoque?")) {
        estoque = [];
        salvarEstoque();
        atualizarTabela();
      }
    }

    function atualizarTabela() {
      const tabela = document.getElementById('tabela-estoque');
      tabela.innerHTML = "";
      let totalVenda = 0;
      let totalCompra = 0;

      estoque.forEach(produto => {
        const totalProdutoVenda = produto.quantidade * produto.valorVenda;
        const totalProdutoCompra = produto.quantidade * produto.valorCompra;
        totalVenda += totalProdutoVenda;
        totalCompra += totalProdutoCompra;

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${produto.nome}</td>
          <td>${produto.quantidade}</td>
          <td>R$ ${produto.valorCompra.toFixed(2)}</td>
          <td>R$ ${produto.valorVenda.toFixed(2)}</td>
          <td>R$ ${totalProdutoVenda.toFixed(2)}</td>
          <td>
            <button class="btn btn-danger btn-sm" onclick="removerProduto('${produto.nome}')">Remover</button>
          </td>
        `;
        tabela.appendChild(tr);
      });

      document.getElementById('total-estoque').textContent = totalVenda.toFixed(2);
      document.getElementById('gastos').textContent = totalCompra.toFixed(2);
      document.getElementById('lucros').textContent = (totalVenda - totalCompra).toFixed(2);
      document.getElementById('consumo').textContent = (totalVenda * 0.1).toFixed(2); // Consumo interno fixo 10%
    }

    function exportarCSV() {
      if (estoque.length === 0) {
        alert("Nenhum produto para exportar.");
        return;
      }

      let csv = "Produto,Quantidade,Valor de Compra,Valor de Venda,Valor Total em Venda\n";
      estoque.forEach(p => {
        const totalVenda = p.quantidade * p.valorVenda;
        csv += `"${p.nome}",${p.quantidade},${p.valorCompra.toFixed(2)},${p.valorVenda.toFixed(2)},${totalVenda.toFixed(2)}\n`;
      });

      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = "estoque.csv";
      a.click();
      URL.revokeObjectURL(url);
    }

    // --- Funções Funcionários ---

    function salvarFuncionarios() {
      localStorage.setItem("funcionarios", JSON.stringify(funcionarios));
    }

    function adicionarFuncionario() {
      const nome = document.getElementById('funcionario-nome').value.trim();
      const cargo = document.getElementById('funcionario-cargo').value.trim();
      const salario = parseFloat(document.getElementById('funcionario-salario').value);

      if (!nome || !cargo || isNaN(salario) || salario <= 0) {
        alert("Preencha os dados do funcionário corretamente.");
        return;
      }

      funcionarios.push({ nome, cargo, salario });
      salvarFuncionarios();
      atualizarFuncionarios();

      // Limpar campos
      limparCamposFuncionario();

      // Garantir botão volta ao modo "Cadastrar"
      resetBotaoFuncionario();
    }

    function atualizarFuncionarios() {
      const lista = document.getElementById('lista-funcionarios');
      lista.innerHTML = "";
      funcionarios.forEach((f, index) => {
        const li = document.createElement('li');
        li.className = 'list-group-item d-flex justify-content-between align-items-center';

        li.innerHTML = `
          <div>
            <strong>${f.nome}</strong> - ${f.cargo} - R$ ${f.salario.toFixed(2)}
          </div>
          <div>
            <button class="btn btn-sm btn-warning me-2" onclick="editarFuncionario(${index})">Editar</button>
            <button class="btn btn-sm btn-danger" onclick="removerFuncionario(${index})">Remover</button>
          </div>
        `;
        lista.appendChild(li);
      });
    }

    function removerFuncionario(index) {
      if(confirm(`Deseja realmente remover o funcionário ${funcionarios[index].nome}?`)) {
        funcionarios.splice(index, 1);
        salvarFuncionarios();
        atualizarFuncionarios();
      }
    }

    function editarFuncionario(index) {
      const f = funcionarios[index];
      document.getElementById('funcionario-nome').value = f.nome;
      document.getElementById('funcionario-cargo').value = f.cargo;
      document.getElementById('funcionario-salario').value = f.salario;

      const btn = document.getElementById('btnAdicionarFuncionario');
      btn.textContent = "Salvar";
      btn.classList.remove('btn-outline-success');
      btn.classList.add('btn-outline-primary');

      // Remover evento antigo e adicionar novo para salvar edição
      btn.onclick = function() {
        salvarEdicaoFuncionario(index);
      };
    }

    function salvarEdicaoFuncionario(index) {
      const nome = document.getElementById('funcionario-nome').value.trim();
      const cargo = document.getElementById('funcionario-cargo').value.trim();
      const salario = parseFloat(document.getElementById('funcionario-salario').value);

      if (!nome || !cargo || isNaN(salario) || salario <= 0) {
        alert("Preencha os dados do funcionário corretamente.");
        return;
      }

      funcionarios[index] = { nome, cargo, salario };
      salvarFuncionarios();
      atualizarFuncionarios();
      limparCamposFuncionario();
      resetBotaoFuncionario();
    }

    function limparCamposFuncionario() {
      document.getElementById('funcionario-nome').value = "";
      document.getElementById('funcionario-cargo').value = "";
      document.getElementById('funcionario-salario').value = "";
    }

    function resetBotaoFuncionario() {
      const btn = document.getElementById('btnAdicionarFuncionario');
      btn.textContent = "Cadastrar";
      btn.classList.remove('btn-outline-primary');
      btn.classList.add('btn-outline-success');
      btn.onclick = adicionarFuncionario;
    }

    // --- Eventos ---

    document.getElementById('btnAdicionarProduto').addEventListener('click', adicionarProduto);
    document.getElementById('btnLimparEstoque').addEventListener('click', limparEstoque);
    document.getElementById('btnExportarCSV').addEventListener('click', exportarCSV);
    document.getElementById('btnAdicionarFuncionario').addEventListener('click', adicionarFuncionario);

    // Inicialização
    atualizarTabela();
    atualizarFuncionarios();
  </script>
</body>
</html>
